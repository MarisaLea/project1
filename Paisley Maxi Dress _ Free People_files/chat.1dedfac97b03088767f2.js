/*! fp@3.30.0 87556bd */
(window.ssWebpackJsonp=window.ssWebpackJsonp||[]).push([[14],{1128:function(t,e,n){"use strict";n.r(e);var a=n(15),i=n(101),r=n(0),o=n(4),c=n(6),s=n.n(c),l=n(16),u=n(13),d=n(2),h=n(14),v=n(1),b=n(12),p=n(45),f=n(21),m=n(22);function g(){return(g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}var C={name:"ChatInviteModal",components:{UrbnButton:f.a,UrbnIcon:m.a},data:function(){return{observer:null,hasEnteredViewport:!1}},watch:{hasEnteredViewport:function(t){t?document.addEventListener("keyup",this.onKeyUp):document.removeEventListener("keyup",this.onKeyUp)}},created:function(){this.avatarImgURL=s.a.salesforce.chat.avatarImgURL},mounted:function(){this.initObserver()},destroyed:function(){this.destroyObserver(),document.removeEventListener("keyup",this.onKeyUp)},methods:g({},Object(o.b)({handleLinkEvent:u.g}),{initObserver:function(){if(!window.IntersectionObserver)return this.$logger.debug("IntersectionObserver not available."),void(this.hasEnteredViewport=!0);this.observer=new IntersectionObserver(this.onInviteVisible,{rootMargin:"0px",threshold:[0,1]}),this.observer.observe(this.$refs.invite)},destroyObserver:function(){this.observer&&(this.$logger.debug("Unregistering IntersectionObserver"),this.observer.unobserve(this.$refs.invite),this.observer.disconnect(),this.observer=null)},openChatWindow:function(){try{window.embedded_svc.inviteAPI.inviteButton.acceptInvite()}catch(t){this.$logger.warn("Unable to accept chat invite",t)}this.handleLinkEvent({event_action:"Chat Accepted",event_label:""})},closeChatWindow:function(){try{window.embedded_svc.inviteAPI.inviteButton.rejectInvite(),this.handleLinkEvent({event_action:"Chat Rejected",event_label:""})}catch(t){this.$logger.warn("Unable to reject chat invite",t)}},onKeyUp:function(t){27===t.keyCode&&this.closeChatWindow()},onInviteVisible:function(t){this.hasEnteredViewport=void 0!==t.find((function(t){return 1===t.intersectionRatio}))}})},y=(n(971),n(3)),_=n(972),w=Object(y.a)(C,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"invite",staticClass:"c-pwa-chat-invitation",attrs:{id:"snapins_invite",role:"dialog",tabindex:"-1"}},[n("div",{staticClass:"c-pwa-chat-invitation__inner"},[n("img",{staticClass:"c-pwa-chat-invitation__avatar",attrs:{src:t.avatarImgURL,alt:t.$t("site-logo-title")}}),t._v(" "),n("p",{staticClass:"c-pwa-chat-invitation__heading"},[t._v("\n            "+t._s(t.$t("chat-invitation_heading"))+"\n        ")]),t._v(" "),n("p",{staticClass:"c-pwa-chat-invitation__subheading"},[t._v("\n            "+t._s(t.$t("chat-invitation_body-copy"))+"\n        ")])]),t._v(" "),n("div",{staticClass:"c-pwa-chat-invitation__buttons"},[n("div",{staticClass:"o-pwa-row o-pwa-row--reverse"},[n("div",{staticClass:"o-pwa-extra-small--12 o-pwa-medium--6"},[n("UrbnButton",{staticClass:"c-pwa-chat-invitation__accept",attrs:{styleType:"primary"},on:{click:t.openChatWindow}},[t._v("\n\n                    "+t._s(t.$t("chat-invitation_accept-cta"))+"\n                ")])],1),t._v(" "),n("div",{staticClass:"o-pwa-extra-small--12 o-pwa-medium--6"},[n("UrbnButton",{staticClass:"c-pwa-chat-invitation__decline",attrs:{styleType:"secondary"},on:{click:t.closeChatWindow}},[t._v("\n\n                    "+t._s(t.$t("chat-invitation_decline"))+"\n                ")])],1)])]),t._v(" "),n("UrbnButton",{staticClass:"c-pwa-chat-invitation__close",attrs:{"aria-label":t.$t("modal-close"),"data-qa-modal-x":""},on:{click:t.closeChatWindow}},[n("UrbnIcon",{staticClass:"c-pwa-chat-invitation__close-icon",attrs:{ariaHidden:!0,icon:"close"}})],1)],1)}),[],!1,null,null,null);"function"==typeof _.default&&Object(_.default)(w);var A=w.exports;function I(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],a=!0,i=!1,r=void 0;try{for(var o,c=t[Symbol.iterator]();!(a=(o=c.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(s){i=!0,r=s}finally{try{a||null==c.return||c.return()}finally{if(i)throw r}}return n}(t,e)||S(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(t,e,n,a,i,r,o){try{var c=t[r](o),s=c.value}catch(l){return void n(l)}c.done?e(s):Promise.resolve(s).then(a,i)}function L(t){return function(){var e=this,n=arguments;return new Promise((function(a,i){var r=t.apply(e,n);function o(t){O(r,a,i,o,c,"next",t)}function c(t){O(r,a,i,o,c,"throw",t)}o(void 0)}))}}function E(t){return function(t){if(Array.isArray(t))return j(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||S(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){if(t){if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function F(){return(F=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}var x={name:"Chat",components:{ChatInviteModal:A},data:function(){return{embeddedServiceScript:null,isReactive:!1}},computed:F({},Object(o.c)(["chatConfig"]),Object(o.e)({chatQueue:function(t){return t.chatQueue},profile:function(t){return t.profile}}),Object(o.e)(b.b,{cartCount:function(t){return t.cartCount},discountableSubtotal:function(t){return t.discountableSubtotal}}),{enabledFeatures:function(){return["LiveAgent"]},entryFeature:function(){return"LiveAgent"},extraPrechatFormDetails:function(){return[{label:"Discountable Subtotal",value:this.discountableSubtotal,displayToAgent:!0,transcriptFields:["DiscountableSubtotal__c"]},{label:"Chat Queue",value:this.chatQueue,displayToAgent:!0,transcriptFields:["ChatQueue"]},{label:"Cart Count",value:this.cartCount,displayToAgent:!0,transcriptFields:["CartCount__c"]},{label:"URBN Tracer",value:Object(r.a)(this.$a15Svc,"tokenSession.tracer"),displayToAgent:!0,transcriptFields:["TracerValue__c"]},{label:"Brand",value:s.a.brand,displayToAgent:!0},{label:"origin",value:this.isReactive?"Live Agent":"Live Agent Proactive",displayToAgent:!1}].concat(E(this.profile?[{label:"First Name",value:Object(r.a)(this.profile,"name.first"),displayToAgent:!0,transcriptFields:["FirstName__c"]},{label:"Last Name",value:Object(r.a)(this.profile,"name.last"),displayToAgent:!0,transcriptFields:["LastName__c"]},{label:"Email Address",value:Object(r.a)(this.profile,"emailAddress"),displayToAgent:!0,transcriptFields:["Customer_Email__c"]},{label:"Loyalty Member",value:"",displayToAgent:!0,transcriptFields:["LoyaltyMember__c"]}]:[]))},extraPrechatInfo:function(){return[{entityName:"Account",showOnCreate:!0,linkToEntityName:"Case",linkToEntityField:"AccountId",saveToTranscript:"AccountId",entityFieldMaps:[{isExactMatch:!0,fieldName:"Brand__c",doCreate:!1,doFind:!0,label:"Brand"},{isExactMatch:!0,fieldName:"PersonEmail",doCreate:!1,doFind:!0,label:"Email"}]},{entityName:"Case",showOnCreate:!0,saveToTranscript:"CaseId",entityFieldMaps:[{isExactMatch:!1,fieldName:"Subject",doCreate:!0,doFind:!1,label:"issue"},{isExactMatch:!1,fieldName:"Status",doCreate:!0,doFind:!1,label:"Status"},{isExactMatch:!1,fieldName:"Origin",doCreate:!0,doFind:!1,label:"origin"},{isExactMatch:!1,fieldName:"Brand__c",doCreate:!0,doFind:!1,label:"Brand"}]}]},baseConfig:function(){var t=this.chatConfig||{},e=t.baseLiveAgentContentURL,n=t.baseLiveAgentURL,a=s.a.salesforce.chat,i=a.avatarImgURL;return{baseLiveAgentContentURL:e,baseLiveAgentURL:n,deploymentId:a.deploymentId,isOfflineSupportEnabled:!1,avatarImgURL:i,chatbotAvatarImgURL:i,smallCompanyLogoImgURL:i}},proactiveConfig:function(){var t=s.a.salesforce.chat,e=t.proactiveButtonId,n=t.proactiveEswLiveAgentDevName;return F({},this.baseConfig,{buttonId:e,displayHelpButton:!1,enabledFeatures:this.enabledFeatures,entryFeature:this.entryFeature,eswLiveAgentDevName:n,extraPrechatFormDetails:this.extraPrechatFormDetails,extraPrechatInfo:this.extraPrechatInfo})},reactiveConfig:function(){var t=s.a.salesforce.chat,e=t.reactiveButtonId,n=t.reactiveEswLiveAgentDevName;return F({},this.baseConfig,{buttonId:e,displayHelpButton:!1,enabledFeatures:this.enabledFeatures,entryFeature:this.entryFeature,eswLiveAgentDevName:n,extraPrechatFormDetails:this.extraPrechatFormDetails,extraPrechatInfo:this.extraPrechatInfo})},customChatVariables:function(){return{discountSubtotal:this.discountableSubtotal,chatQueue:this.chatQueue}},shouldShowChat:function(){return null!==this.baseConfig&&null!==this.embeddedServiceScript}}),mounted:function(){var t=this;return L(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(v.k)(t.chatConfig)){e.next=3;break}return t.$logger.warn("Contentful configuration not set"),e.abrupt("return");case 3:return e.prev=3,e.next=6,t.appendChatAssets();case 6:t.unwatchCustomChatVariables=t.$watch("customChatVariables",(function(){t.updateChatData(),t.$nextTick((function(){t.initializeChat(t.proactiveConfig)}))})),t.unwatchRoutePath=t.$watch("$route.path",(function(){null!==t.chatQueue&&t.setChatQueue(null)})),t.unwatchRouteHash=t.$watch("$route.hash",(function(e){e===s.a.salesforce.chat.initHash&&t.acceptChatFromHash()}),{immediate:!0}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),t.$logger.warn("Unable to load chat",e.t0);case 14:case"end":return e.stop()}}),e,null,[[3,11]])})))()},destroyed:function(){this.unloadChatAssets(),Object(i.a)(this,"unwatchCustomChatVariables"),Object(i.a)(this,"unwatchRoutePath"),Object(i.a)(this,"unwatchRouteHash")},methods:F({},Object(o.b)({handleLinkEvent:u.g}),Object(o.b)(d.g,{popModals:p.e}),Object(o.d)({setChatQueue:u.i}),{appendChatAssets:function(){var t=this;return L(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(r.a)(s.a,"salesforce.chat.embeddedServiceURL")){e.next=3;break}throw new Error("Embedded Service url not set");case 3:return e.next=5,Object(v.n)({type:"script",src:n},document);case 5:if(a=e.sent,window.embedded_svc){e.next=8;break}throw new Error("Embedded Service not available");case 8:t.embeddedServiceScript=a,t.initializeChat(t.proactiveConfig),t.updateChatData(),document.addEventListener("click",t.handleMinimizeChat);case 12:case"end":return e.stop()}}),e)})))()},acceptChatFromHash:function(){var t=this;return L(regeneratorRuntime.mark((function e(){var n,i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,i={initializingChat:!0},e.next=4,t.popModals({outcome:i});case 4:t.removeHash(),t.initializeChat(t.reactiveConfig,!0),t.sendReactiveChatAnalytics(),r=setInterval((function(){if(++n>10)return t.$logger.error("Chat never initialized, canceling polling"),void clearInterval(r);try{if(Object(a.a)(window.embedded_svc.inviteAPI.inviteButton.acceptInvite))return t.$logger.debug("Accepting chat invite"),clearInterval(r),void window.embedded_svc.inviteAPI.inviteButton.acceptInvite()}catch(e){t.$logger.warn("Unable to accept chat invite",e)}}),1e3);case 8:case"end":return e.stop()}}),e)})))()},initializeChat:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isReactive=e;var n=s.a.salesforce.chat,a=n.proactiveEswConfigDevName,i=n.reactiveEswConfigDevName,r=n.gslbBaseURL,o=this.chatConfig,c=o.orgId,l=o.baseCoreURL,u=o.communityEndpointURL;window.embedded_svc.settings=F({},window.embedded_svc.settings,t);var d=e?i:a;window.embedded_svc.init(l,u,r,c,d,t)},removeHash:function(){Object(h.t)(this.$router,this.$route.query,!1,!0)},sendReactiveChatAnalytics:function(){this.handleLinkEvent({event_action:"Reactive Chat Click",event_label:""})},updateChatData:function(){var t=this;Object.entries(this.customChatVariables).forEach((function(e){var n=I(e,2),a=n[0],r=n[1];t.$logger.debug("Updating ".concat(a," to ").concat(r)),Object(i.a)(window.embedded_svc,"inviteAPI.inviteButton.setCustomVariable",a,r)}))},unloadChatAssets:function(){Object(i.a)(this.embeddedServiceScript,"parentNode.removeChild",this.embeddedServiceScript),document.removeEventListener("click",this.handleMinimizeChat),window.embedded_svc=void 0},handleMinimizeChat:function(t){Object(l.e)(t.target,"minimizeButton")&&this.handleLinkEvent({event_action:"minimize chat",event_label:""})}})},U=(n(973),n(974),n(975)),R=Object(y.a)(x,(function(){var t=this.$createElement,e=this._self._c||t;return this.shouldShowChat?e("div",{staticClass:"c-pwa-chat"},[e("ChatInviteModal",{ref:"invitation"})],1):this._e()}),[],!1,null,null,null);"function"==typeof U.default&&Object(U.default)(R);e.default=R.exports},767:function(t,e,n){},768:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"en-GB":{"chat-invitation_heading":"Any Questions?","chat-invitation_body-copy":"A customer service agent is online and available to chat.","chat-invitation_accept-cta":"Start Live Chat","chat-invitation_decline":"No Thanks","modal-close":"Close","site-logo-title":"Free People"},"en-US":{"chat-invitation_heading":"Any Questions?","chat-invitation_body-copy":"A customer service agent is online and available to chat.","chat-invitation_accept-cta":"Start Live Chat","chat-invitation_decline":"No Thanks","modal-close":"Close","site-logo-title":"Free People"},"zh-CN":{"chat-invitation_heading":"Any Questions?","chat-invitation_body-copy":"A customer service agent is online and available to chat.","chat-invitation_accept-cta":"Start Live Chat","chat-invitation_decline":"No Thanks","modal-close":"关闭","site-logo-title":"Free People"}}'),delete t.options._Ctor}},769:function(t,e,n){},770:function(t,e,n){},771:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"en-GB":{"chat-invitation_heading":"Any Questions?"},"en-US":{"chat-invitation_heading":"Any Questions?"},"zh-CN":{"chat-invitation_heading":"Any Questions?"}}'),delete t.options._Ctor}},971:function(t,e,n){"use strict";var a=n(767);n.n(a).a},972:function(t,e,n){"use strict";var a=n(768),i=n.n(a);e.default=i.a},973:function(t,e,n){"use strict";var a=n(769);n.n(a).a},974:function(t,e,n){"use strict";var a=n(770);n.n(a).a},975:function(t,e,n){"use strict";var a=n(771),i=n.n(a);e.default=i.a}}]);
//# sourceMappingURL=chat.1dedfac97b03088767f2.js.map